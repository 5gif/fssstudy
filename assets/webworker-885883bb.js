(function(){"use strict";var N=63710088e-1,Ne={centimeters:N*100,centimetres:N*100,degrees:N/111325,feet:N*3.28084,inches:N*39.37,kilometers:N/1e3,kilometres:N/1e3,meters:N,metres:N,miles:N/1609.344,millimeters:N*1e3,millimetres:N*1e3,nauticalmiles:N/1852,radians:1,yards:N*1.0936},ft={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/N,yards:1.0936133},Ie={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function z(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function ct(e,r,t){switch(e){case"Point":return K(r).geometry;case"LineString":return j(r).geometry;case"Polygon":return ge(r).geometry;case"MultiPoint":return hr(r).geometry;case"MultiLineString":return $e(r).geometry;case"MultiPolygon":return vr(r).geometry;default:throw new Error(e+" is invalid")}}function K(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xe(e[0])||!Xe(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return z(n,r,t)}function ht(e,r,t){return t===void 0&&(t={}),H(e.map(function(n){return K(n,r)}),t)}function ge(e,r,t){t===void 0&&(t={});for(var n=0,u=e;n<u.length;n++){var o=u[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}var h={type:"Polygon",coordinates:e};return z(h,r,t)}function vt(e,r,t){return t===void 0&&(t={}),H(e.map(function(n){return ge(n,r)}),t)}function j(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return z(n,r,t)}function mt(e,r,t){return t===void 0&&(t={}),H(e.map(function(n){return j(n,r)}),t)}function H(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function $e(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return z(n,r,t)}function hr(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return z(n,r,t)}function vr(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return z(n,r,t)}function dt(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return z(n,r,t)}function pt(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function We(e,r){r===void 0&&(r="kilometers");var t=Ne[r];if(!t)throw new Error(r+" units is invalid");return e*t}function Je(e,r){r===void 0&&(r="kilometers");var t=Ne[r];if(!t)throw new Error(r+" units is invalid");return e/t}function gt(e,r){return mr(Je(e,r))}function yt(e){var r=e%360;return r<0&&(r+=360),r}function mr(e){var r=e%(2*Math.PI);return r*180/Math.PI}function ye(e){var r=e%360;return r*Math.PI/180}function Mt(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return We(Je(e,r),t)}function xt(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Ie[r];if(!n)throw new Error("invalid original units");var u=Ie[t];if(!u)throw new Error("invalid final units");return e/n*u}function Xe(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ke(e){return!!e&&e.constructor===Object}function wt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Xe(r))throw new Error("bbox must only contain numbers")})}function Et(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}var Pt=Object.freeze({__proto__:null,areaFactors:Ie,bearingToAzimuth:yt,convertArea:xt,convertLength:Mt,degreesToRadians:ye,earthRadius:N,factors:Ne,feature:z,featureCollection:H,geometry:ct,geometryCollection:dt,isNumber:Xe,isObject:Ke,lengthToDegrees:gt,lengthToRadians:Je,lineString:j,lineStrings:mt,multiLineString:$e,multiPoint:hr,multiPolygon:vr,point:K,points:ht,polygon:ge,polygons:vt,radiansToDegrees:mr,radiansToLength:We,round:pt,unitsFactors:ft,validateBBox:wt,validateId:Et});function oe(e,r,t){if(e!==null)for(var n,u,o,l,h,c,g,X=0,E=0,x,B=e.type,P=B==="FeatureCollection",w=B==="Feature",L=P?e.features.length:1,S=0;S<L;S++){g=P?e.features[S].geometry:w?e.geometry:e,x=g?g.type==="GeometryCollection":!1,h=x?g.geometries.length:1;for(var i=0;i<h;i++){var a=0,s=0;if(l=x?g.geometries[i]:g,l!==null){c=l.coordinates;var f=l.type;switch(X=t&&(f==="Polygon"||f==="MultiPolygon")?1:0,f){case null:break;case"Point":if(r(c,E,S,a,s)===!1)return!1;E++,a++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(r(c[n],E,S,a,s)===!1)return!1;E++,f==="MultiPoint"&&a++}f==="LineString"&&a++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(u=0;u<c[n].length-X;u++){if(r(c[n][u],E,S,a,s)===!1)return!1;E++}f==="MultiLineString"&&a++,f==="Polygon"&&s++}f==="Polygon"&&a++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(s=0,u=0;u<c[n].length;u++){for(o=0;o<c[n][u].length-X;o++){if(r(c[n][u][o],E,S,a,s)===!1)return!1;E++}s++}a++}break;case"GeometryCollection":for(n=0;n<l.geometries.length;n++)if(oe(l.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Bt(e,r,t,n){var u=t;return oe(e,function(o,l,h,c,g){l===0&&t===void 0?u=o:u=r(u,o,l,h,c,g)},n),u}function dr(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function Xt(e,r,t){var n=t;return dr(e,function(u,o){o===0&&t===void 0?n=u:n=r(n,u,o)}),n}function _e(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function _t(e,r,t){var n=t;return _e(e,function(u,o){o===0&&t===void 0?n=u:n=r(n,u,o)}),n}function Yt(e){var r=[];return oe(e,function(t){r.push(t)}),r}function ze(e,r){var t,n,u,o,l,h,c,g,X,E,x=0,B=e.type==="FeatureCollection",P=e.type==="Feature",w=B?e.features.length:1;for(t=0;t<w;t++){for(h=B?e.features[t].geometry:P?e.geometry:e,g=B?e.features[t].properties:P?e.properties:{},X=B?e.features[t].bbox:P?e.bbox:void 0,E=B?e.features[t].id:P?e.id:void 0,c=h?h.type==="GeometryCollection":!1,l=c?h.geometries.length:1,u=0;u<l;u++){if(o=c?h.geometries[u]:h,o===null){if(r(null,x,g,X,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(o,x,g,X,E)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(r(o.geometries[n],x,g,X,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function bt(e,r,t){var n=t;return ze(e,function(u,o,l,h,c){o===0&&t===void 0?n=u:n=r(n,u,o,l,h,c)}),n}function ue(e,r){ze(e,function(t,n,u,o,l){var h=t===null?null:t.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return r(z(t,u,{bbox:o,id:l}),n,0)===!1?!1:void 0}var c;switch(h){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var g=0;g<t.coordinates.length;g++){var X=t.coordinates[g],E={type:c,coordinates:X};if(r(z(E,u),n,g)===!1)return!1}})}function Lt(e,r,t){var n=t;return ue(e,function(u,o,l){o===0&&l===0&&t===void 0?n=u:n=r(n,u,o,l)}),n}function pr(e,r){ue(e,function(t,n,u){var o=0;if(t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var h,c=0,g=0,X=0;if(oe(t,function(E,x,B,P,w){if(h===void 0||n>c||P>g||w>X){h=E,c=n,g=P,X=w,o=0;return}var L=j([h,E],t.properties);if(r(L,n,u,w,o)===!1)return!1;o++,h=E})===!1)return!1}}})}function St(e,r,t){var n=t,u=!1;return pr(e,function(o,l,h,c,g){u===!1&&t===void 0?n=o:n=r(n,o,l,h,c,g),u=!0}),n}function gr(e,r){if(!e)throw new Error("geojson is required");ue(e,function(t,n,u){if(t.geometry!==null){var o=t.geometry.type,l=t.geometry.coordinates;switch(o){case"LineString":if(r(t,n,u,0,0)===!1)return!1;break;case"Polygon":for(var h=0;h<l.length;h++)if(r(j(l[h],t.properties),n,u,h)===!1)return!1;break}}})}function Rt(e,r,t){var n=t;return gr(e,function(u,o,l,h){o===0&&t===void 0?n=u:n=r(n,u,o,l,h)}),n}function At(e,r){if(r=r||{},!Ke(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,u=r.geometryIndex||0,o=r.segmentIndex||0,l=r.properties,h;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),l=l||e.features[t].properties,h=e.features[t].geometry;break;case"Feature":l=l||e.properties,h=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=e;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var c=h.coordinates;switch(h.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=c.length+o-1),j([c[o],c[o+1]],l,r);case"Polygon":return u<0&&(u=c.length+u),o<0&&(o=c[u].length+o-1),j([c[u][o],c[u][o+1]],l,r);case"MultiLineString":return n<0&&(n=c.length+n),o<0&&(o=c[n].length+o-1),j([c[n][o],c[n][o+1]],l,r);case"MultiPolygon":return n<0&&(n=c.length+n),u<0&&(u=c[n].length+u),o<0&&(o=c[n][u].length-o-1),j([c[n][u][o],c[n][u][o+1]],l,r)}throw new Error("geojson is invalid")}function Ct(e,r){if(r=r||{},!Ke(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,u=r.geometryIndex||0,o=r.coordIndex||0,l=r.properties,h;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),l=l||e.features[t].properties,h=e.features[t].geometry;break;case"Feature":l=l||e.properties,h=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=e;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var c=h.coordinates;switch(h.type){case"Point":return K(c,l,r);case"MultiPoint":return n<0&&(n=c.length+n),K(c[n],l,r);case"LineString":return o<0&&(o=c.length+o),K(c[o],l,r);case"Polygon":return u<0&&(u=c.length+u),o<0&&(o=c[u].length+o),K(c[u][o],l,r);case"MultiLineString":return n<0&&(n=c.length+n),o<0&&(o=c[n].length+o),K(c[n][o],l,r);case"MultiPolygon":return n<0&&(n=c.length+n),u<0&&(u=c[n].length+u),o<0&&(o=c[n][u].length-o),K(c[n][u][o],l,r)}throw new Error("geojson is invalid")}var Ot=Object.freeze({__proto__:null,coordAll:Yt,coordEach:oe,coordReduce:Bt,featureEach:_e,featureReduce:_t,findPoint:Ct,findSegment:At,flattenEach:ue,flattenReduce:Lt,geomEach:ze,geomReduce:bt,lineEach:gr,lineReduce:Rt,propEach:dr,propReduce:Xt,segmentEach:pr,segmentReduce:St});function Ye(e){var r=[1/0,1/0,-1/0,-1/0];return oe(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}Ye.default=Ye;var kt=Object.freeze({__proto__:null,default:Ye});function be(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Me(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Le(e){return e.type==="Feature"?e.geometry:e}function Ft(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}var He=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Se(e){if(e.__esModule)return e;var r=e.default;if(typeof r=="function"){var t=function n(){if(this instanceof n){var u=[null];u.push.apply(u,arguments);var o=Function.bind.apply(r,u);return new o}return r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var u=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,u.get?u:{enumerable:!0,get:function(){return e[n]}})}),t}var Qe={exports:{}},Mr={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(He,function(){function t(i,a,s,f,v){(function m(d,p,M,y,b){for(;y>M;){if(y-M>600){var _=y-M+1,R=p-M+1,D=Math.log(_),k=.5*Math.exp(2*D/3),F=.5*Math.sqrt(D*k*(_-k)/_)*(R-_/2<0?-1:1),G=Math.max(M,Math.floor(p-R*k/_+F)),J=Math.min(y,Math.floor(p+(_-R)*k/_+F));m(d,p,G,J,b)}var Y=d[p],C=M,A=y;for(n(d,M,p),b(d[y],Y)>0&&n(d,M,y);C<A;){for(n(d,C,A),C++,A--;b(d[C],Y)<0;)C++;for(;b(d[A],Y)>0;)A--}b(d[M],Y)===0?n(d,M,A):n(d,++A,y),A<=p&&(M=A+1),p<=A&&(y=A-1)}})(i,a,s||0,f||i.length-1,v||u)}function n(i,a,s){var f=i[a];i[a]=i[s],i[s]=f}function u(i,a){return i<a?-1:i>a?1:0}var o=function(i){i===void 0&&(i=9),this._maxEntries=Math.max(4,i),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(i,a,s){if(!s)return a.indexOf(i);for(var f=0;f<a.length;f++)if(s(i,a[f]))return f;return-1}function h(i,a){c(i,0,i.children.length,a,i)}function c(i,a,s,f,v){v||(v=L(null)),v.minX=1/0,v.minY=1/0,v.maxX=-1/0,v.maxY=-1/0;for(var m=a;m<s;m++){var d=i.children[m];g(v,i.leaf?f(d):d)}return v}function g(i,a){return i.minX=Math.min(i.minX,a.minX),i.minY=Math.min(i.minY,a.minY),i.maxX=Math.max(i.maxX,a.maxX),i.maxY=Math.max(i.maxY,a.maxY),i}function X(i,a){return i.minX-a.minX}function E(i,a){return i.minY-a.minY}function x(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function B(i){return i.maxX-i.minX+(i.maxY-i.minY)}function P(i,a){return i.minX<=a.minX&&i.minY<=a.minY&&a.maxX<=i.maxX&&a.maxY<=i.maxY}function w(i,a){return a.minX<=i.maxX&&a.minY<=i.maxY&&a.maxX>=i.minX&&a.maxY>=i.minY}function L(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(i,a,s,f,v){for(var m=[a,s];m.length;)if(!((s=m.pop())-(a=m.pop())<=f)){var d=a+Math.ceil((s-a)/f/2)*f;t(i,d,a,s,v),m.push(a,d,d,s)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(i){var a=this.data,s=[];if(!w(i,a))return s;for(var f=this.toBBox,v=[];a;){for(var m=0;m<a.children.length;m++){var d=a.children[m],p=a.leaf?f(d):d;w(i,p)&&(a.leaf?s.push(d):P(i,p)?this._all(d,s):v.push(d))}a=v.pop()}return s},o.prototype.collides=function(i){var a=this.data;if(!w(i,a))return!1;for(var s=[];a;){for(var f=0;f<a.children.length;f++){var v=a.children[f],m=a.leaf?this.toBBox(v):v;if(w(i,m)){if(a.leaf||P(i,m))return!0;s.push(v)}}a=s.pop()}return!1},o.prototype.load=function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var a=0;a<i.length;a++)this.insert(i[a]);return this}var s=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){var f=this.data;this.data=s,s=f}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},o.prototype.insert=function(i){return i&&this._insert(i,this.data.height-1),this},o.prototype.clear=function(){return this.data=L([]),this},o.prototype.remove=function(i,a){if(!i)return this;for(var s,f,v,m=this.data,d=this.toBBox(i),p=[],M=[];m||p.length;){if(m||(m=p.pop(),f=p[p.length-1],s=M.pop(),v=!0),m.leaf){var y=l(i,m.children,a);if(y!==-1)return m.children.splice(y,1),p.push(m),this._condense(p),this}v||m.leaf||!P(m,d)?f?(s++,m=f.children[s],v=!1):m=null:(p.push(m),M.push(s),s=0,f=m,m=m.children[0])}return this},o.prototype.toBBox=function(i){return i},o.prototype.compareMinX=function(i,a){return i.minX-a.minX},o.prototype.compareMinY=function(i,a){return i.minY-a.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(i){return this.data=i,this},o.prototype._all=function(i,a){for(var s=[];i;)i.leaf?a.push.apply(a,i.children):s.push.apply(s,i.children),i=s.pop();return a},o.prototype._build=function(i,a,s,f){var v,m=s-a+1,d=this._maxEntries;if(m<=d)return h(v=L(i.slice(a,s+1)),this.toBBox),v;f||(f=Math.ceil(Math.log(m)/Math.log(d)),d=Math.ceil(m/Math.pow(d,f-1))),(v=L([])).leaf=!1,v.height=f;var p=Math.ceil(m/d),M=p*Math.ceil(Math.sqrt(d));S(i,a,s,M,this.compareMinX);for(var y=a;y<=s;y+=M){var b=Math.min(y+M-1,s);S(i,y,b,p,this.compareMinY);for(var _=y;_<=b;_+=p){var R=Math.min(_+p-1,b);v.children.push(this._build(i,_,R,f-1))}}return h(v,this.toBBox),v},o.prototype._chooseSubtree=function(i,a,s,f){for(;f.push(a),!a.leaf&&f.length-1!==s;){for(var v=1/0,m=1/0,d=void 0,p=0;p<a.children.length;p++){var M=a.children[p],y=x(M),b=(_=i,R=M,(Math.max(R.maxX,_.maxX)-Math.min(R.minX,_.minX))*(Math.max(R.maxY,_.maxY)-Math.min(R.minY,_.minY))-y);b<m?(m=b,v=y<v?y:v,d=M):b===m&&y<v&&(v=y,d=M)}a=d||a.children[0]}var _,R;return a},o.prototype._insert=function(i,a,s){var f=s?i:this.toBBox(i),v=[],m=this._chooseSubtree(f,this.data,a,v);for(m.children.push(i),g(m,f);a>=0&&v[a].children.length>this._maxEntries;)this._split(v,a),a--;this._adjustParentBBoxes(f,v,a)},o.prototype._split=function(i,a){var s=i[a],f=s.children.length,v=this._minEntries;this._chooseSplitAxis(s,v,f);var m=this._chooseSplitIndex(s,v,f),d=L(s.children.splice(m,s.children.length-m));d.height=s.height,d.leaf=s.leaf,h(s,this.toBBox),h(d,this.toBBox),a?i[a-1].children.push(d):this._splitRoot(s,d)},o.prototype._splitRoot=function(i,a){this.data=L([i,a]),this.data.height=i.height+1,this.data.leaf=!1,h(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(i,a,s){for(var f,v,m,d,p,M,y,b=1/0,_=1/0,R=a;R<=s-a;R++){var D=c(i,0,R,this.toBBox),k=c(i,R,s,this.toBBox),F=(v=D,m=k,d=void 0,p=void 0,M=void 0,y=void 0,d=Math.max(v.minX,m.minX),p=Math.max(v.minY,m.minY),M=Math.min(v.maxX,m.maxX),y=Math.min(v.maxY,m.maxY),Math.max(0,M-d)*Math.max(0,y-p)),G=x(D)+x(k);F<b?(b=F,f=R,_=G<_?G:_):F===b&&G<_&&(_=G,f=R)}return f||s-a},o.prototype._chooseSplitAxis=function(i,a,s){var f=i.leaf?this.compareMinX:X,v=i.leaf?this.compareMinY:E;this._allDistMargin(i,a,s,f)<this._allDistMargin(i,a,s,v)&&i.children.sort(f)},o.prototype._allDistMargin=function(i,a,s,f){i.children.sort(f);for(var v=this.toBBox,m=c(i,0,a,v),d=c(i,s-a,s,v),p=B(m)+B(d),M=a;M<s-a;M++){var y=i.children[M];g(m,i.leaf?v(y):y),p+=B(m)}for(var b=s-a-1;b>=a;b--){var _=i.children[b];g(d,i.leaf?v(_):_),p+=B(d)}return p},o.prototype._adjustParentBBoxes=function(i,a,s){for(var f=s;f>=0;f--)g(a[f],i)},o.prototype._condense=function(i){for(var a=i.length-1,s=void 0;a>=0;a--)i[a].children.length===0?a>0?(s=i[a-1].children).splice(s.indexOf(i[a]),1):this.clear():h(i[a],this.toBBox)},o})})(Mr);var Gt=Mr.exports;class Tt{constructor(r=[],t=Dt){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,u=t[r];for(;r>0;){const o=r-1>>1,l=t[o];if(n(u,l)>=0)break;t[r]=l,r=o}t[r]=u}_down(r){const{data:t,compare:n}=this,u=this.length>>1,o=t[r];for(;r<u;){let l=(r<<1)+1,h=t[l];const c=l+1;if(c<this.length&&n(t[c],h)<0&&(l=c,h=t[c]),n(h,o)>=0)break;t[r]=h,r=l}t[r]=o}}function Dt(e,r){return e<r?-1:e>r?1:0}var qt=Object.freeze({__proto__:null,default:Tt}),Nt=Se(qt),Re={exports:{}},It=function(r,t,n,u){var o=r[0],l=r[1],h=!1;n===void 0&&(n=0),u===void 0&&(u=t.length);for(var c=(u-n)/2,g=0,X=c-1;g<c;X=g++){var E=t[n+g*2+0],x=t[n+g*2+1],B=t[n+X*2+0],P=t[n+X*2+1],w=x>l!=P>l&&o<(B-E)*(l-x)/(P-x)+E;w&&(h=!h)}return h},$t=function(r,t,n,u){var o=r[0],l=r[1],h=!1;n===void 0&&(n=0),u===void 0&&(u=t.length);for(var c=u-n,g=0,X=c-1;g<c;X=g++){var E=t[g+n][0],x=t[g+n][1],B=t[X+n][0],P=t[X+n][1],w=x>l!=P>l&&o<(B-E)*(l-x)/(P-x)+E;w&&(h=!h)}return h},xr=It,wr=$t;Re.exports=function(r,t,n,u){return t.length>0&&Array.isArray(t[0])?wr(r,t,n,u):xr(r,t,n,u)},Re.exports.nested=wr,Re.exports.flat=xr;var Wt=Re.exports,Ve={exports:{}};(function(e,r){(function(t,n){n(r)})(He,function(t){const u=33306690738754706e-32;function o(w,L,S,i,a){let s,f,v,m,d=L[0],p=i[0],M=0,y=0;p>d==p>-d?(s=d,d=L[++M]):(s=p,p=i[++y]);let b=0;if(M<w&&y<S)for(p>d==p>-d?(v=s-((f=d+s)-d),d=L[++M]):(v=s-((f=p+s)-p),p=i[++y]),s=f,v!==0&&(a[b++]=v);M<w&&y<S;)p>d==p>-d?(v=s-((f=s+d)-(m=f-s))+(d-m),d=L[++M]):(v=s-((f=s+p)-(m=f-s))+(p-m),p=i[++y]),s=f,v!==0&&(a[b++]=v);for(;M<w;)v=s-((f=s+d)-(m=f-s))+(d-m),d=L[++M],s=f,v!==0&&(a[b++]=v);for(;y<S;)v=s-((f=s+p)-(m=f-s))+(p-m),p=i[++y],s=f,v!==0&&(a[b++]=v);return s===0&&b!==0||(a[b++]=s),b}function l(w){return new Float64Array(w)}const h=33306690738754716e-32,c=22204460492503146e-32,g=11093356479670487e-47,X=l(4),E=l(8),x=l(12),B=l(16),P=l(4);t.orient2d=function(w,L,S,i,a,s){const f=(L-s)*(S-a),v=(w-a)*(i-s),m=f-v;if(f===0||v===0||f>0!=v>0)return m;const d=Math.abs(f+v);return Math.abs(m)>=h*d?m:-function(p,M,y,b,_,R,D){let k,F,G,J,Y,C,A,I,T,$,O,q,Q,W,V,Z,fe,U;const ee=p-_,re=y-_,te=M-R,ne=b-R;Y=(V=(I=ee-(A=(C=134217729*ee)-(C-ee)))*($=ne-(T=(C=134217729*ne)-(C-ne)))-((W=ee*ne)-A*T-I*T-A*$))-(O=V-(fe=(I=te-(A=(C=134217729*te)-(C-te)))*($=re-(T=(C=134217729*re)-(C-re)))-((Z=te*re)-A*T-I*T-A*$))),X[0]=V-(O+Y)+(Y-fe),Y=(Q=W-((q=W+O)-(Y=q-W))+(O-Y))-(O=Q-Z),X[1]=Q-(O+Y)+(Y-Z),Y=(U=q+O)-q,X[2]=q-(U-Y)+(O-Y),X[3]=U;let ce=function($n,st){let lt=st[0];for(let cr=1;cr<$n;cr++)lt+=st[cr];return lt}(4,X),Be=c*D;if(ce>=Be||-ce>=Be||(k=p-(ee+(Y=p-ee))+(Y-_),G=y-(re+(Y=y-re))+(Y-_),F=M-(te+(Y=M-te))+(Y-R),J=b-(ne+(Y=b-ne))+(Y-R),k===0&&F===0&&G===0&&J===0)||(Be=g*D+u*Math.abs(ce),(ce+=ee*J+ne*k-(te*G+re*F))>=Be||-ce>=Be))return ce;Y=(V=(I=k-(A=(C=134217729*k)-(C-k)))*($=ne-(T=(C=134217729*ne)-(C-ne)))-((W=k*ne)-A*T-I*T-A*$))-(O=V-(fe=(I=F-(A=(C=134217729*F)-(C-F)))*($=re-(T=(C=134217729*re)-(C-re)))-((Z=F*re)-A*T-I*T-A*$))),P[0]=V-(O+Y)+(Y-fe),Y=(Q=W-((q=W+O)-(Y=q-W))+(O-Y))-(O=Q-Z),P[1]=Q-(O+Y)+(Y-Z),Y=(U=q+O)-q,P[2]=q-(U-Y)+(O-Y),P[3]=U;const qn=o(4,X,4,P,E);Y=(V=(I=ee-(A=(C=134217729*ee)-(C-ee)))*($=J-(T=(C=134217729*J)-(C-J)))-((W=ee*J)-A*T-I*T-A*$))-(O=V-(fe=(I=te-(A=(C=134217729*te)-(C-te)))*($=G-(T=(C=134217729*G)-(C-G)))-((Z=te*G)-A*T-I*T-A*$))),P[0]=V-(O+Y)+(Y-fe),Y=(Q=W-((q=W+O)-(Y=q-W))+(O-Y))-(O=Q-Z),P[1]=Q-(O+Y)+(Y-Z),Y=(U=q+O)-q,P[2]=q-(U-Y)+(O-Y),P[3]=U;const Nn=o(qn,E,4,P,x);Y=(V=(I=k-(A=(C=134217729*k)-(C-k)))*($=J-(T=(C=134217729*J)-(C-J)))-((W=k*J)-A*T-I*T-A*$))-(O=V-(fe=(I=F-(A=(C=134217729*F)-(C-F)))*($=G-(T=(C=134217729*G)-(C-G)))-((Z=F*G)-A*T-I*T-A*$))),P[0]=V-(O+Y)+(Y-fe),Y=(Q=W-((q=W+O)-(Y=q-W))+(O-Y))-(O=Q-Z),P[1]=Q-(O+Y)+(Y-Z),Y=(U=q+O)-q,P[2]=q-(U-Y)+(O-Y),P[3]=U;const In=o(Nn,x,4,P,B);return B[In-1]}(w,L,S,i,a,s,d)},t.orient2dfast=function(w,L,S,i,a,s){return(L-s)*(S-a)-(w-a)*(i-s)},Object.defineProperty(t,"__esModule",{value:!0})})})(Ve,Ve.exports);var Jt=Ve.exports,Er=Gt,Ae=Nt,Kt=Wt,zt=Jt.orient2d;Ae.default&&(Ae=Ae.default),Qe.exports=Pr,Qe.exports.default=Pr;function Pr(e,r,t){r=Math.max(0,r===void 0?2:r),t=t||0;var n=Ut(e),u=new Er(16);u.toBBox=function(i){return{minX:i[0],minY:i[1],maxX:i[0],maxY:i[1]}},u.compareMinX=function(i,a){return i[0]-a[0]},u.compareMinY=function(i,a){return i[1]-a[1]},u.load(e);for(var o=[],l=0,h;l<n.length;l++){var c=n[l];u.remove(c),h=_r(c,h),o.push(h)}var g=new Er(16);for(l=0;l<o.length;l++)g.insert(Ze(o[l]));for(var X=r*r,E=t*t;o.length;){var x=o.shift(),B=x.p,P=x.next.p,w=Ue(B,P);if(!(w<E)){var L=w/X;c=Ht(u,x.prev.p,B,P,x.next.next.p,L,g),c&&Math.min(Ue(c,B),Ue(c,P))<=L&&(o.push(x),o.push(_r(c,x)),u.remove(c),g.remove(x),g.insert(Ze(x)),g.insert(Ze(x.next)))}}x=h;var S=[];do S.push(x.p),x=x.next;while(x!==h);return S.push(x.p),S}function Ht(e,r,t,n,u,o,l){for(var h=new Ae([],Qt),c=e.data;c;){for(var g=0;g<c.children.length;g++){var X=c.children[g],E=c.leaf?je(X,t,n):Vt(t,n,X);E>o||h.push({node:X,dist:E})}for(;h.length&&!h.peek().node.children;){var x=h.pop(),B=x.node,P=je(B,r,t),w=je(B,n,u);if(x.dist<P&&x.dist<w&&Xr(t,B,l)&&Xr(n,B,l))return B}c=h.pop(),c&&(c=c.node)}return null}function Qt(e,r){return e.dist-r.dist}function Vt(e,r,t){if(Br(e,t)||Br(r,t))return 0;var n=Ce(e[0],e[1],r[0],r[1],t.minX,t.minY,t.maxX,t.minY);if(n===0)return 0;var u=Ce(e[0],e[1],r[0],r[1],t.minX,t.minY,t.minX,t.maxY);if(u===0)return 0;var o=Ce(e[0],e[1],r[0],r[1],t.maxX,t.minY,t.maxX,t.maxY);if(o===0)return 0;var l=Ce(e[0],e[1],r[0],r[1],t.minX,t.maxY,t.maxX,t.maxY);return l===0?0:Math.min(n,u,o,l)}function Br(e,r){return e[0]>=r.minX&&e[0]<=r.maxX&&e[1]>=r.minY&&e[1]<=r.maxY}function Xr(e,r,t){for(var n=Math.min(e[0],r[0]),u=Math.min(e[1],r[1]),o=Math.max(e[0],r[0]),l=Math.max(e[1],r[1]),h=t.search({minX:n,minY:u,maxX:o,maxY:l}),c=0;c<h.length;c++)if(Zt(h[c].p,h[c].next.p,e,r))return!1;return!0}function he(e,r,t){return zt(e[0],e[1],r[0],r[1],t[0],t[1])}function Zt(e,r,t,n){return e!==n&&r!==t&&he(e,r,t)>0!=he(e,r,n)>0&&he(t,n,e)>0!=he(t,n,r)>0}function Ze(e){var r=e.p,t=e.next.p;return e.minX=Math.min(r[0],t[0]),e.minY=Math.min(r[1],t[1]),e.maxX=Math.max(r[0],t[0]),e.maxY=Math.max(r[1],t[1]),e}function Ut(e){for(var r=e[0],t=e[0],n=e[0],u=e[0],o=0;o<e.length;o++){var l=e[o];l[0]<r[0]&&(r=l),l[0]>n[0]&&(n=l),l[1]<t[1]&&(t=l),l[1]>u[1]&&(u=l)}var h=[r,t,n,u],c=h.slice();for(o=0;o<e.length;o++)Kt(e[o],h)||c.push(e[o]);return en(c)}function _r(e,r){var t={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return r?(t.next=r.next,t.prev=r,r.next.prev=t,r.next=t):(t.prev=t,t.next=t),t}function Ue(e,r){var t=e[0]-r[0],n=e[1]-r[1];return t*t+n*n}function je(e,r,t){var n=r[0],u=r[1],o=t[0]-n,l=t[1]-u;if(o!==0||l!==0){var h=((e[0]-n)*o+(e[1]-u)*l)/(o*o+l*l);h>1?(n=t[0],u=t[1]):h>0&&(n+=o*h,u+=l*h)}return o=e[0]-n,l=e[1]-u,o*o+l*l}function Ce(e,r,t,n,u,o,l,h){var c=t-e,g=n-r,X=l-u,E=h-o,x=e-u,B=r-o,P=c*c+g*g,w=c*X+g*E,L=X*X+E*E,S=c*x+g*B,i=X*x+E*B,a=P*L-w*w,s,f,v,m,d=a,p=a;a===0?(f=0,d=1,m=i,p=L):(f=w*i-L*S,m=P*i-w*S,f<0?(f=0,m=i,p=L):f>d&&(f=d,m=i+w,p=L)),m<0?(m=0,-S<0?f=0:-S>P?f=d:(f=-S,d=P)):m>p&&(m=p,-S+w<0?f=0:-S+w>P?f=d:(f=-S+w,d=P)),s=f===0?0:f/d,v=m===0?0:m/p;var M=(1-s)*e+s*t,y=(1-s)*r+s*n,b=(1-v)*u+v*l,_=(1-v)*o+v*h,R=b-M,D=_-y;return R*R+D*D}function jt(e,r){return e[0]===r[0]?e[1]-r[1]:e[0]-r[0]}function en(e){e.sort(jt);for(var r=[],t=0;t<e.length;t++){for(;r.length>=2&&he(r[r.length-2],r[r.length-1],e[t])<=0;)r.pop();r.push(e[t])}for(var n=[],u=e.length-1;u>=0;u--){for(;n.length>=2&&he(n[n.length-2],n[n.length-1],e[u])<=0;)n.pop();n.push(e[u])}return n.pop(),r.pop(),r.concat(n)}var rn=Qe.exports,tn=yr(rn);function nn(e,r){r===void 0&&(r={}),r.concavity=r.concavity||1/0;var t=[];if(oe(e,function(u){t.push([u[0],u[1]])}),!t.length)return null;var n=tn(t,r.concavity);return n.length>3?ge([n]):null}function xe(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("point is required");if(!r)throw new Error("polygon is required");var n=be(e),u=Le(r),o=u.type,l=r.bbox,h=u.coordinates;if(l&&an(n,l)===!1)return!1;o==="Polygon"&&(h=[h]);for(var c=!1,g=0;g<h.length&&!c;g++)if(Yr(n,h[g][0],t.ignoreBoundary)){for(var X=!1,E=1;E<h[g].length&&!X;)Yr(n,h[g][E],!t.ignoreBoundary)&&(X=!0),E++;X||(c=!0)}return c}function Yr(e,r,t){var n=!1;r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]&&(r=r.slice(0,r.length-1));for(var u=0,o=r.length-1;u<r.length;o=u++){var l=r[u][0],h=r[u][1],c=r[o][0],g=r[o][1],X=e[1]*(l-c)+h*(c-e[0])+g*(e[0]-l)===0&&(l-e[0])*(c-e[0])<=0&&(h-e[1])*(g-e[1])<=0;if(X)return!t;var E=h>e[1]!=g>e[1]&&e[0]<(c-l)*(e[1]-h)/(g-h)+l;E&&(n=!n)}return n}function an(e,r){return r[0]<=e[0]&&r[1]<=e[1]&&r[2]>=e[0]&&r[3]>=e[1]}function br(e,r,t){t===void 0&&(t={});var n=be(e),u=be(r),o=ye(u[1]-n[1]),l=ye(u[0]-n[0]),h=ye(n[1]),c=ye(u[1]),g=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(h)*Math.cos(c);return We(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),t.units)}function Lr(e,r){r===void 0&&(r={});var t=0,n=0,u=0;return oe(e,function(o){t+=o[0],n+=o[1],u++},!0),K([t/u,n/u],r.properties)}function er(e,r){switch(r===void 0&&(r={}),Ft(e)){case"Point":return K(be(e),r.properties);case"Polygon":var t=[];oe(e,function(s){t.push(s)});var n=Lr(e,{properties:r.properties}),u=n.geometry.coordinates,o=0,l=0,h=0,c,g,X,E,x,B,P,w,L=t.map(function(s){return[s[0]-u[0],s[1]-u[1]]});for(c=0;c<t.length-1;c++)g=L[c],E=g[0],B=g[1],X=L[c+1],x=X[0],P=X[1],w=E*P-x*B,h+=w,o+=(E+x)*w,l+=(B+P)*w;if(h===0)return n;var S=h*.5,i=1/(6*S);return K([u[0]+i*o,u[1]+i*l],r.properties);default:var a=nn(e);return a?er(a,{properties:r.properties}):Lr(e,{properties:r.properties})}}function Sr(e){if(!e)throw new Error("geojson is required");var r=[];return ue(e,function(t){on(t,r)}),H(r)}function on(e,r){var t=[],n=e.geometry;if(n!==null){switch(n.type){case"Polygon":t=Me(n);break;case"LineString":t=[Me(n)]}t.forEach(function(u){var o=un(u,e.properties);o.forEach(function(l){l.id=r.length,r.push(l)})})}}function un(e,r){var t=[];return e.reduce(function(n,u){var o=j([n,u],r);return o.bbox=sn(n,u),t.push(o),u}),t}function sn(e,r){var t=e[0],n=e[1],u=r[0],o=r[1],l=t<u?t:u,h=n<o?n:o,c=t>u?t:u,g=n>o?n:o;return[l,h,c,g]}var rr={exports:{}},Rr={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(He,function(){function t(i,a,s,f,v){(function m(d,p,M,y,b){for(;y>M;){if(y-M>600){var _=y-M+1,R=p-M+1,D=Math.log(_),k=.5*Math.exp(2*D/3),F=.5*Math.sqrt(D*k*(_-k)/_)*(R-_/2<0?-1:1),G=Math.max(M,Math.floor(p-R*k/_+F)),J=Math.min(y,Math.floor(p+(_-R)*k/_+F));m(d,p,G,J,b)}var Y=d[p],C=M,A=y;for(n(d,M,p),b(d[y],Y)>0&&n(d,M,y);C<A;){for(n(d,C,A),C++,A--;b(d[C],Y)<0;)C++;for(;b(d[A],Y)>0;)A--}b(d[M],Y)===0?n(d,M,A):n(d,++A,y),A<=p&&(M=A+1),p<=A&&(y=A-1)}})(i,a,s||0,f||i.length-1,v||u)}function n(i,a,s){var f=i[a];i[a]=i[s],i[s]=f}function u(i,a){return i<a?-1:i>a?1:0}var o=function(i){i===void 0&&(i=9),this._maxEntries=Math.max(4,i),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(i,a,s){if(!s)return a.indexOf(i);for(var f=0;f<a.length;f++)if(s(i,a[f]))return f;return-1}function h(i,a){c(i,0,i.children.length,a,i)}function c(i,a,s,f,v){v||(v=L(null)),v.minX=1/0,v.minY=1/0,v.maxX=-1/0,v.maxY=-1/0;for(var m=a;m<s;m++){var d=i.children[m];g(v,i.leaf?f(d):d)}return v}function g(i,a){return i.minX=Math.min(i.minX,a.minX),i.minY=Math.min(i.minY,a.minY),i.maxX=Math.max(i.maxX,a.maxX),i.maxY=Math.max(i.maxY,a.maxY),i}function X(i,a){return i.minX-a.minX}function E(i,a){return i.minY-a.minY}function x(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function B(i){return i.maxX-i.minX+(i.maxY-i.minY)}function P(i,a){return i.minX<=a.minX&&i.minY<=a.minY&&a.maxX<=i.maxX&&a.maxY<=i.maxY}function w(i,a){return a.minX<=i.maxX&&a.minY<=i.maxY&&a.maxX>=i.minX&&a.maxY>=i.minY}function L(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(i,a,s,f,v){for(var m=[a,s];m.length;)if(!((s=m.pop())-(a=m.pop())<=f)){var d=a+Math.ceil((s-a)/f/2)*f;t(i,d,a,s,v),m.push(a,d,d,s)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(i){var a=this.data,s=[];if(!w(i,a))return s;for(var f=this.toBBox,v=[];a;){for(var m=0;m<a.children.length;m++){var d=a.children[m],p=a.leaf?f(d):d;w(i,p)&&(a.leaf?s.push(d):P(i,p)?this._all(d,s):v.push(d))}a=v.pop()}return s},o.prototype.collides=function(i){var a=this.data;if(!w(i,a))return!1;for(var s=[];a;){for(var f=0;f<a.children.length;f++){var v=a.children[f],m=a.leaf?this.toBBox(v):v;if(w(i,m)){if(a.leaf||P(i,m))return!0;s.push(v)}}a=s.pop()}return!1},o.prototype.load=function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var a=0;a<i.length;a++)this.insert(i[a]);return this}var s=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){var f=this.data;this.data=s,s=f}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},o.prototype.insert=function(i){return i&&this._insert(i,this.data.height-1),this},o.prototype.clear=function(){return this.data=L([]),this},o.prototype.remove=function(i,a){if(!i)return this;for(var s,f,v,m=this.data,d=this.toBBox(i),p=[],M=[];m||p.length;){if(m||(m=p.pop(),f=p[p.length-1],s=M.pop(),v=!0),m.leaf){var y=l(i,m.children,a);if(y!==-1)return m.children.splice(y,1),p.push(m),this._condense(p),this}v||m.leaf||!P(m,d)?f?(s++,m=f.children[s],v=!1):m=null:(p.push(m),M.push(s),s=0,f=m,m=m.children[0])}return this},o.prototype.toBBox=function(i){return i},o.prototype.compareMinX=function(i,a){return i.minX-a.minX},o.prototype.compareMinY=function(i,a){return i.minY-a.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(i){return this.data=i,this},o.prototype._all=function(i,a){for(var s=[];i;)i.leaf?a.push.apply(a,i.children):s.push.apply(s,i.children),i=s.pop();return a},o.prototype._build=function(i,a,s,f){var v,m=s-a+1,d=this._maxEntries;if(m<=d)return h(v=L(i.slice(a,s+1)),this.toBBox),v;f||(f=Math.ceil(Math.log(m)/Math.log(d)),d=Math.ceil(m/Math.pow(d,f-1))),(v=L([])).leaf=!1,v.height=f;var p=Math.ceil(m/d),M=p*Math.ceil(Math.sqrt(d));S(i,a,s,M,this.compareMinX);for(var y=a;y<=s;y+=M){var b=Math.min(y+M-1,s);S(i,y,b,p,this.compareMinY);for(var _=y;_<=b;_+=p){var R=Math.min(_+p-1,b);v.children.push(this._build(i,_,R,f-1))}}return h(v,this.toBBox),v},o.prototype._chooseSubtree=function(i,a,s,f){for(;f.push(a),!a.leaf&&f.length-1!==s;){for(var v=1/0,m=1/0,d=void 0,p=0;p<a.children.length;p++){var M=a.children[p],y=x(M),b=(_=i,R=M,(Math.max(R.maxX,_.maxX)-Math.min(R.minX,_.minX))*(Math.max(R.maxY,_.maxY)-Math.min(R.minY,_.minY))-y);b<m?(m=b,v=y<v?y:v,d=M):b===m&&y<v&&(v=y,d=M)}a=d||a.children[0]}var _,R;return a},o.prototype._insert=function(i,a,s){var f=s?i:this.toBBox(i),v=[],m=this._chooseSubtree(f,this.data,a,v);for(m.children.push(i),g(m,f);a>=0&&v[a].children.length>this._maxEntries;)this._split(v,a),a--;this._adjustParentBBoxes(f,v,a)},o.prototype._split=function(i,a){var s=i[a],f=s.children.length,v=this._minEntries;this._chooseSplitAxis(s,v,f);var m=this._chooseSplitIndex(s,v,f),d=L(s.children.splice(m,s.children.length-m));d.height=s.height,d.leaf=s.leaf,h(s,this.toBBox),h(d,this.toBBox),a?i[a-1].children.push(d):this._splitRoot(s,d)},o.prototype._splitRoot=function(i,a){this.data=L([i,a]),this.data.height=i.height+1,this.data.leaf=!1,h(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(i,a,s){for(var f,v,m,d,p,M,y,b=1/0,_=1/0,R=a;R<=s-a;R++){var D=c(i,0,R,this.toBBox),k=c(i,R,s,this.toBBox),F=(v=D,m=k,d=void 0,p=void 0,M=void 0,y=void 0,d=Math.max(v.minX,m.minX),p=Math.max(v.minY,m.minY),M=Math.min(v.maxX,m.maxX),y=Math.min(v.maxY,m.maxY),Math.max(0,M-d)*Math.max(0,y-p)),G=x(D)+x(k);F<b?(b=F,f=R,_=G<_?G:_):F===b&&G<_&&(_=G,f=R)}return f||s-a},o.prototype._chooseSplitAxis=function(i,a,s){var f=i.leaf?this.compareMinX:X,v=i.leaf?this.compareMinY:E;this._allDistMargin(i,a,s,f)<this._allDistMargin(i,a,s,v)&&i.children.sort(f)},o.prototype._allDistMargin=function(i,a,s,f){i.children.sort(f);for(var v=this.toBBox,m=c(i,0,a,v),d=c(i,s-a,s,v),p=B(m)+B(d),M=a;M<s-a;M++){var y=i.children[M];g(m,i.leaf?v(y):y),p+=B(m)}for(var b=s-a-1;b>=a;b--){var _=i.children[b];g(d,i.leaf?v(_):_),p+=B(d)}return p},o.prototype._adjustParentBBoxes=function(i,a,s){for(var f=s;f>=0;f--)g(a[f],i)},o.prototype._condense=function(i){for(var a=i.length-1,s=void 0;a>=0;a--)i[a].children.length===0?a>0?(s=i[a-1].children).splice(s.indexOf(i[a]),1):this.clear():h(i[a],this.toBBox)},o})})(Rr);var ln=Rr.exports,fn=Se(Pt),cn=Se(Ot),hn=Se(kt),ie=ln,Ar=fn,Cr=cn,ve=hn.default,vn=Cr.featureEach;Cr.coordEach,Ar.polygon;var Or=Ar.featureCollection;function kr(e){var r=new ie(e);return r.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ve(t),ie.prototype.insert.call(this,t)},r.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(u){if(u.type!=="Feature")throw new Error("invalid features");u.bbox=u.bbox?u.bbox:ve(u),n.push(u)}):vn(t,function(u){if(u.type!=="Feature")throw new Error("invalid features");u.bbox=u.bbox?u.bbox:ve(u),n.push(u)}),ie.prototype.load.call(this,n)},r.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ve(t),ie.prototype.remove.call(this,t,n)},r.clear=function(){return ie.prototype.clear.call(this)},r.search=function(t){var n=ie.prototype.search.call(this,this.toBBox(t));return Or(n)},r.collides=function(t){return ie.prototype.collides.call(this,this.toBBox(t))},r.all=function(){var t=ie.prototype.all.call(this);return Or(t)},r.toJSON=function(){return ie.prototype.toJSON.call(this)},r.fromJSON=function(t){return ie.prototype.fromJSON.call(this,t)},r.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ve(t);else if(t.type==="FeatureCollection")n=ve(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},r}rr.exports=kr,rr.exports.default=kr;var mn=rr.exports,dn=yr(mn);function tr(e,r){var t={},n=[];if(e.type==="LineString"&&(e=z(e)),r.type==="LineString"&&(r=z(r)),e.type==="Feature"&&r.type==="Feature"&&e.geometry!==null&&r.geometry!==null&&e.geometry.type==="LineString"&&r.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&r.geometry.coordinates.length===2){var u=Fr(e,r);return u&&n.push(u),H(n)}var o=dn();return o.load(Sr(r)),_e(Sr(e),function(l){_e(o.search(l),function(h){var c=Fr(l,h);if(c){var g=Me(c).join(",");t[g]||(t[g]=!0,n.push(c))}})}),H(n)}function Fr(e,r){var t=Me(e),n=Me(r);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var u=t[0][0],o=t[0][1],l=t[1][0],h=t[1][1],c=n[0][0],g=n[0][1],X=n[1][0],E=n[1][1],x=(E-g)*(l-u)-(X-c)*(h-o),B=(X-c)*(o-g)-(E-g)*(u-c),P=(l-u)*(o-g)-(h-o)*(u-c);if(x===0)return null;var w=B/x,L=P/x;if(w>=0&&w<=1&&L>=0&&L<=1){var S=u+w*(l-u),i=o+w*(h-o);return K([S,i])}return null}function nr(e,r){r===void 0&&(r={});var t=Le(e);switch(!r.properties&&e.type==="Feature"&&(r.properties=e.properties),t.type){case"Polygon":return pn(t,r);case"MultiPolygon":return gn(t,r);default:throw new Error("invalid poly")}}function pn(e,r){r===void 0&&(r={});var t=Le(e),n=t.coordinates,u=r.properties?r.properties:e.type==="Feature"?e.properties:{};return Gr(n,u)}function gn(e,r){r===void 0&&(r={});var t=Le(e),n=t.coordinates,u=r.properties?r.properties:e.type==="Feature"?e.properties:{},o=[];return n.forEach(function(l){o.push(Gr(l,u))}),H(o)}function Gr(e,r){return e.length>1?$e(e,r):j(e[0],r)}function yn(e,r){var t=!0;return ue(e,function(n){ue(r,function(u){if(t===!1)return!1;t=Mn(n.geometry,u.geometry)})}),t}function Mn(e,r){switch(e.type){case"Point":switch(r.type){case"Point":return!Pn(e.coordinates,r.coordinates);case"LineString":return!Tr(r,e);case"Polygon":return!xe(e,r)}break;case"LineString":switch(r.type){case"Point":return!Tr(e,r);case"LineString":return!xn(e,r);case"Polygon":return!Dr(r,e)}break;case"Polygon":switch(r.type){case"Point":return!xe(r,e);case"LineString":return!Dr(e,r);case"Polygon":return!wn(r,e)}}return!1}function Tr(e,r){for(var t=0;t<e.coordinates.length-1;t++)if(En(e.coordinates[t],e.coordinates[t+1],r.coordinates))return!0;return!1}function xn(e,r){var t=tr(e,r);return t.features.length>0}function Dr(e,r){for(var t=0,n=r.coordinates;t<n.length;t++){var u=n[t];if(xe(u,e))return!0}var o=tr(r,nr(e));return o.features.length>0}function wn(e,r){for(var t=0,n=e.coordinates[0];t<n.length;t++){var u=n[t];if(xe(u,r))return!0}for(var o=0,l=r.coordinates[0];o<l.length;o++){var h=l[o];if(xe(h,e))return!0}var c=tr(nr(e),nr(r));return c.features.length>0}function En(e,r,t){var n=t[0]-e[0],u=t[1]-e[1],o=r[0]-e[0],l=r[1]-e[1],h=n*l-u*o;return h!==0?!1:Math.abs(o)>=Math.abs(l)?o>0?e[0]<=t[0]&&t[0]<=r[0]:r[0]<=t[0]&&t[0]<=e[0]:l>0?e[1]<=t[1]&&t[1]<=r[1]:r[1]<=t[1]&&t[1]<=e[1]}function Pn(e,r){return e[0]===r[0]&&e[1]===r[1]}function qr(e,r){var t=!1;return ue(e,function(n){ue(r,function(u){if(t===!0)return!0;t=!yn(n.geometry,u.geometry)})}),t}function Bn(e,r,t,n){n===void 0&&(n={});for(var u=[],o=e[0],l=e[1],h=e[2],c=e[3],g=r/br([o,l],[h,l],n),X=g*(h-o),E=t/br([o,l],[o,c],n),x=E*(c-l),B=h-o,P=c-l,w=Math.floor(B/X),L=Math.floor(P/x),S=(B-w*X)/2,i=(P-L*x)/2,a=o+S,s=0;s<w;s++){for(var f=l+i,v=0;v<L;v++){var m=ge([[[a,f],[a,f+x],[a+X,f+x],[a+X,f],[a,f]]],n.properties);n.mask?qr(n.mask,m)&&u.push(m):u.push(m),f+=x}a+=X}return H(u)}function Xn(e,r,t){return t===void 0&&(t={}),Bn(e,r,r,t)}class Nr{constructor(){this._partials=new Float64Array(32),this._n=0}add(r){const t=this._partials;let n=0;for(let u=0;u<this._n&&u<32;u++){const o=t[u],l=r+o,h=Math.abs(r)<Math.abs(o)?r-(l-o):o-(l-r);h&&(t[n++]=h),r=l}return t[n]=r,this._n=n+1,this}valueOf(){const r=this._partials;let t=this._n,n,u,o,l=0;if(t>0){for(l=r[--t];t>0&&(n=l,u=r[--t],l=n+u,o=u-(l-n),!o););t>0&&(o<0&&r[t-1]<0||o>0&&r[t-1]>0)&&(u=o*2,n=l+u,u==n-l&&(l=n))}return l}}var Oe=1e-6,Ir=1e-12,le=Math.PI,ke=le/2,$r=le/4,Wr=le*2,me=le/180,ir=Math.abs,Jr=Math.atan2,se=Math.cos,ae=Math.sin,_n=Math.sign||function(e){return e>0?1:e<0?-1:0},Kr=Math.sqrt;function Yn(e){return e>1?ke:e<-1?-ke:Math.asin(e)}function de(){}function Fe(e,r){e&&Hr.hasOwnProperty(e.type)&&Hr[e.type](e,r)}var zr={Feature:function(e,r){Fe(e.geometry,r)},FeatureCollection:function(e,r){for(var t=e.features,n=-1,u=t.length;++n<u;)Fe(t[n].geometry,r)}},Hr={Sphere:function(e,r){r.sphere()},Point:function(e,r){e=e.coordinates,r.point(e[0],e[1],e[2])},MultiPoint:function(e,r){for(var t=e.coordinates,n=-1,u=t.length;++n<u;)e=t[n],r.point(e[0],e[1],e[2])},LineString:function(e,r){ar(e.coordinates,r,0)},MultiLineString:function(e,r){for(var t=e.coordinates,n=-1,u=t.length;++n<u;)ar(t[n],r,0)},Polygon:function(e,r){Qr(e.coordinates,r)},MultiPolygon:function(e,r){for(var t=e.coordinates,n=-1,u=t.length;++n<u;)Qr(t[n],r)},GeometryCollection:function(e,r){for(var t=e.geometries,n=-1,u=t.length;++n<u;)Fe(t[n],r)}};function ar(e,r,t){var n=-1,u=e.length-t,o;for(r.lineStart();++n<u;)o=e[n],r.point(o[0],o[1],o[2]);r.lineEnd()}function Qr(e,r){var t=-1,n=e.length;for(r.polygonStart();++t<n;)ar(e[t],r,1);r.polygonEnd()}function bn(e,r){e&&zr.hasOwnProperty(e.type)?zr[e.type](e,r):Fe(e,r)}function Vr(e){var r=e[0],t=e[1],n=se(t);return[n*se(r),n*ae(r),ae(t)]}function Zr(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]}function Ur(e){var r=Kr(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=r,e[1]/=r,e[2]/=r}function or(e){return ir(e[0])<=le?e[0]:_n(e[0])*((ir(e[0])+le)%Wr-le)}function Ln(e,r){var t=or(r),n=r[1],u=ae(n),o=[ae(t),-se(t),0],l=0,h=0,c=new Nr;u===1?n=ke+Oe:u===-1&&(n=-ke-Oe);for(var g=0,X=e.length;g<X;++g)if(x=(E=e[g]).length)for(var E,x,B=E[x-1],P=or(B),w=B[1]/2+$r,L=ae(w),S=se(w),i=0;i<x;++i,P=s,L=v,S=m,B=a){var a=E[i],s=or(a),f=a[1]/2+$r,v=ae(f),m=se(f),d=s-P,p=d>=0?1:-1,M=p*d,y=M>le,b=L*v;if(c.add(Jr(b*p*ae(M),S*m+b*se(M))),l+=y?d+p*Wr:d,y^P>=t^s>=t){var _=Zr(Vr(B),Vr(a));Ur(_);var R=Zr(o,_);Ur(R);var D=(y^d>=0?-1:1)*Yn(R[2]);(n>D||n===D&&(_[0]||_[1]))&&(h+=y^d>=0?1:-1)}}return(l<-Oe||l<Oe&&c<-Ir)^h&1}var ur,sr,Ge,Te,pe={sphere:de,point:de,lineStart:Sn,lineEnd:de,polygonStart:de,polygonEnd:de};function Sn(){pe.point=An,pe.lineEnd=Rn}function Rn(){pe.point=pe.lineEnd=de}function An(e,r){e*=me,r*=me,sr=e,Ge=ae(r),Te=se(r),pe.point=Cn}function Cn(e,r){e*=me,r*=me;var t=ae(r),n=se(r),u=ir(e-sr),o=se(u),l=ae(u),h=n*l,c=Te*t-Ge*n*o,g=Ge*t+Te*n*o;ur.add(Jr(Kr(h*h+c*c),g)),sr=e,Ge=t,Te=n}function On(e){return ur=new Nr,bn(e,pe),+ur}var lr=[null,null],kn={type:"LineString",coordinates:lr};function fr(e,r){return lr[0]=e,lr[1]=r,On(kn)}var jr={Feature:function(e,r){return De(e.geometry,r)},FeatureCollection:function(e,r){for(var t=e.features,n=-1,u=t.length;++n<u;)if(De(t[n].geometry,r))return!0;return!1}},et={Sphere:function(){return!0},Point:function(e,r){return rt(e.coordinates,r)},MultiPoint:function(e,r){for(var t=e.coordinates,n=-1,u=t.length;++n<u;)if(rt(t[n],r))return!0;return!1},LineString:function(e,r){return tt(e.coordinates,r)},MultiLineString:function(e,r){for(var t=e.coordinates,n=-1,u=t.length;++n<u;)if(tt(t[n],r))return!0;return!1},Polygon:function(e,r){return nt(e.coordinates,r)},MultiPolygon:function(e,r){for(var t=e.coordinates,n=-1,u=t.length;++n<u;)if(nt(t[n],r))return!0;return!1},GeometryCollection:function(e,r){for(var t=e.geometries,n=-1,u=t.length;++n<u;)if(De(t[n],r))return!0;return!1}};function De(e,r){return e&&et.hasOwnProperty(e.type)?et[e.type](e,r):!1}function rt(e,r){return fr(e,r)===0}function tt(e,r){for(var t,n,u,o=0,l=e.length;o<l;o++){if(n=fr(e[o],r),n===0||o>0&&(u=fr(e[o],e[o-1]),u>0&&t<=u&&n<=u&&(t+n-u)*(1-Math.pow((t-n)/u,2))<Ir*u))return!0;t=n}return!1}function nt(e,r){return!!Ln(e.map(Fn),it(r))}function Fn(e){return e=e.map(it),e.pop(),e}function it(e){return[e[0]*me,e[1]*me]}function Gn(e,r){return(e&&jr.hasOwnProperty(e.type)?jr[e.type]:De)(e,r)}function we(e,r,t){this.k=e,this.x=r,this.y=t}we.prototype={constructor:we,scale:function(e){return e===1?this:new we(this.k*e,this.x,this.y)},translate:function(e,r){return e===0&r===0?this:new we(this.k,this.x+this.k*e,this.y+this.k*r)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},we.prototype,console.log("WEB WORKER..init()");let Ee;console.log("WEB WORKER I am called");var Pe=0,qe=5;function at(){Pe<=qe&&(postMessage({type:"status",command:"startTimer",statusType:"progressbar",val:Pe,count:qe}),setTimeout(at,1e3),Pe=Pe+1)}async function Tn(e){let r=!1;console.log("webworker args",typeof e,Array.isArray(e));let t;Array.isArray(e)?t=e:(t=e.countries,r=e.EdgeMode);let n;return ot(t).then(u=>{console.log("List of countries...",u);let o=u;postMessage({type:"status",command:"updateGrid",statusType:"started",value:qe});let l=[],h=0,c=0,g=0;{let E=H(o.filter(x=>!x.properties.hasIMTgrid));if(E.features.length>0){let x=Ye(E),B=Xn(x,1,{units:"degrees"});if(B.features.length==0)return"SELECTED country is smaller than GRID ??";c=0;let P;g=B.features.length,B.features.forEach(w=>{let L=[];L=er(w).geometry.coordinates,w.properties.center=L,w.properties.Country="",w.properties.inLand=!1,E.features.filter(S=>{var i;return r?i=qr(S,w):i=Gn(S,L),i&&(w.properties.inLand=i,w.properties.Country=S.properties.NAMEen,P=w.properties.Country),i}),w.properties.RaRb=!0,w.properties.Active=w.properties.inLand,w.properties.ActiveFactor=w.properties.inLand?1:0,w.properties.id=h,h++,c++,postMessage({type:"status",command:"updateGrid",statusType:"progressbar",meta:P,val:c,count:g})}),l.push(...B.features),n=H(l),postMessage({type:"command",command:"updateGrid",statusType:"completed",meta:P,result:n})}}let X=o.filter(E=>E.properties.hasIMTgrid);if(console.log("Now processing IMT countries ",X),X.length>0){let E;X.forEach(x=>{E=x.properties.NAMEen,postMessage({type:"status",command:"updateGrid",statusType:"running",value:E}),console.log("updateGrid() stage 3"),g=g+x.properties.IMTgrid.features.length,x.properties.IMTgrid.features.forEach(B=>{B.properties.inLand=!0,B.properties.Country=E;let P=er(B).geometry.coordinates;B.properties.center=P,B.properties.RaRb=!1,B.properties.inLand=!0,B.properties.Country=E,B.properties.Active=!0,B.properties.ActiveFactor=1,B.properties.id=h,l.push(B),h++,c++,postMessage({type:"status",command:"updateGrid",statusType:"progressbar",meta:E,val:c,count:g})})}),console.log("updateGrid() stage 4a"),n=H(l),postMessage({type:"command",command:"updateGrid",statusType:"completed",meta:E,result:n})}})}async function Dn(e){return new Promise((r,t)=>{let u=Ee.result.transaction("globalmap","readonly").objectStore("globalmap").get(e);u.onsuccess=o=>{o.target.result!==void 0?(console.log("getCountries() WEB WORKER getRecord",e,o.target.result),r(o.target.result)):r("getCountries() mapinformation EMPTY/Error")},u.onerror=o=>{console.log("getCountries() WEB WORKER getRecord Error"),t(o)}})}async function ot(e){return e=e||[],console.log("WEB WORKDER : getCountries.."),new Promise((r,t)=>{Ee=indexedDB.open("mapinformation",1),Ee.onsuccess=async()=>{let n=Ee.result.transaction("globalmap","readonly").objectStore("globalmap");if(e.length==0){console.log("getCountries() Will READ ALL to indexdb");let u=n.getAll();u.onsuccess=o=>{o.target.result!==void 0?(console.log("getCountries() WEB WORKER getAll",o.target.result),r(o.target.result)):r("getCountries() mapinformation EMPTY/Error")},u.onerror=o=>{console.log("getCountries() WEB WORKER getAll Error"),t(o)}}else{console.log("getCountries() Will READ ",e);let u=e.map(async l=>await Dn(l));console.log("Found myresults ",u);let o=await Promise.all(u);console.log("Found results ",o),r(o)}}})}let ut=1;onmessage=async e=>{console.log("WEB WORKER: Received Hello World ",e.data);let r=e.data;switch(r.command=r.command||"",r.command){case"init":ut=r.version||1,Ee=indexedDB.open("mapinformation",ut);case"timer":Pe=0,console.log("Starting timer... "),qe=5,at();break;case"list":ot().then(t=>{postMessage({msg:"Got Countries",data:t.length,name:"getCountries"})});break;case"updateGrid":Tn(r.data);break;default:console.log("WEB WORKER: No specific command ")}}})();
